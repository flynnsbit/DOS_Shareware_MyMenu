/*
Nyan Cat for the IBM PC

License : CC BY-SA 3.0 http://creativecommons.org/licenses/by-sa/3.0
Author : JoJo@vieju.net
*/

#include <stdio.h>
#include <dos.h>
#include <conio.h>
#include <stdlib.h>
#include <alloc.h>
#include <time.h>

#define frecuencia 8000         // Audio frequency

unsigned int intro_size=(unsigned int)0x7B8D;
unsigned int buffer_size=(unsigned int)0xFFFF;
unsigned int final_size=(unsigned int)0x4CCA;
unsigned char *intro;
unsigned char *buffer0;
unsigned char *buffer1;
unsigned char *buffer2;
unsigned char *final;
unsigned char *frame0;
int cuenta_atras=(int)(1193180L / frecuencia); // Time needed for speaker to
				// stretch in full divided by our playing frecuency
void interrupt (*old_int8)();
void interrupt (*old_int9)();
FILE *archivo;
int offset_pagina[8];
int offset_pagina_div[8];
char pagina=0;
char matriz[8][25][40] = {{           // Animation frames
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,04,04,04,04,04,04,01,01,01,01,01,01,04,04,04,04,04,04,00,00,00,00,00,00,00,00,00,00,00,00,00,00,01,01,01,01,01,01},
{04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,00,14,14,13,13,13,13,13,13,13,13,13,13,14,14,00,01,01,01,01,01},
{04,04,06,06,06,06,06,06,04,04,04,04,04,04,06,06,06,06,06,00,14,13,13,13,13,13,13,13,05,13,13,13,13,14,00,01,01,01,01,01},
{06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,00,13,13,05,13,13,13,13,13,00,13,13,13,13,13,00,01,00,01,01,01},
{06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,00,13,13,13,13,13,13,13,00,07,00,13,13,13,13,00,00,07,00,01,01},
{06,06,14,14,14,14,14,14,06,06,06,06,06,06,14,14,00,14,14,00,13,13,13,13,13,05,13,00,07,07,00,13,13,13,00,07,07,00,01,01},
{14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,00,07,00,14,00,13,13,13,13,13,13,13,00,07,07,07,07,07,07,07,07,07,00,01,01},
{14,14,10,10,10,10,10,10,14,14,14,14,14,14,10,10,00,07,00,00,13,13,13,13,13,13,00,07,07,07,07,07,07,07,07,07,07,07,00,01},
{10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,00,07,07,00,13,05,13,13,13,13,00,07,07,07,00,07,07,07,07,00,07,07,00,01},
{10,10, 9, 9, 9, 9, 9, 9,10,10,10,10,10,10, 9, 9, 9,00,00,00,13,13,13,13,05,13,00,07,12,12,07,07,07,07,07,07,12,12,00,01},
{ 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9,00,14,13,05,13,13,13,00,07,12,12,00,07,07,07,07,00,12,12,00,01},
{ 9, 9,05,05,05,05,05,05, 9, 9, 9, 9, 9, 9,05,05,05,05,00,00,14,14,13,13,13,13,13,00,07,07,00,00,00,00,00,00,07,00,01,01},
{05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,00,07,07,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,01,01,01},
{05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,00,07,07,00,01,00,07,00,01,01,01,01,00,07,00,01,07,07,00,01,01,01,01},
{05,05,01,01,01,01,01,01,05,05,05,05,05,05,01,01,01,00,00,00,01,01,00,00,01,01,01,01,01,01,00,00,01,00,00,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01}
					  },

{
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,04,04,04,04,04,04,01,01,01,01,01,01,04,04,04,04,04,04,00,00,00,00,00,00,00,00,00,00,00,00,00,00,01,01,01,01,01,01},
{04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,00,14,14,13,13,13,13,13,13,13,13,13,13,14,14,00,01,01,01,01,01},
{04,04,06,06,06,06,06,06,04,04,04,04,04,04,06,06,06,06,06,00,14,13,13,13,13,13,13,13,05,13,13,13,13,14,00,01,01,01,01,01},
{06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,00,13,13,05,13,13,13,13,13,00,13,13,13,13,13,00,01,00,01,01,01},
{06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,00,13,13,13,13,13,13,13,00,07,00,13,13,13,13,00,00,07,00,01,01},
{06,06,14,14,14,14,14,14,06,06,06,06,06,06,14,14,14,14,14,00,13,13,13,13,13,05,13,00,07,07,00,13,13,13,00,07,07,00,01,01},
{14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,00,14,00,13,13,13,13,13,13,13,00,07,07,07,07,07,07,07,07,07,00,01,01},
{14,14,10,10,10,10,10,10,14,14,14,14,14,14,10,10,00,07,00,00,13,13,13,13,13,13,00,07,07,07,07,07,07,07,07,07,07,07,00,01},
{10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,00,07,07,00,13,05,13,13,13,13,00,07,07,07,00,07,07,07,07,00,07,07,00,01},
{10,10, 9, 9, 9, 9, 9, 9,10,10,10,10,10,10, 9, 9, 9,00,00,00,13,13,13,13,05,13,00,07,12,12,07,07,07,07,07,07,12,12,00,01},
{ 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9,00,14,13,05,13,13,13,00,07,12,12,00,07,07,07,07,00,12,12,00,01},
{ 9, 9,05,05,05,05,05,05, 9, 9, 9, 9, 9, 9,05,05,05,05,00,00,14,14,13,13,13,13,13,00,07,07,00,00,00,00,00,00,07,00,01,01},
{05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,00,07,07,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,01,01,01},
{05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,00,07,07,00,01,00,07,00,01,01,01,01,00,07,00,01,01,07,00,01,01,01,01},
{05,05,01,01,01,01,01,01,05,05,05,05,05,05,01,01,01,01,00,00,00,01,01,00,00,01,01,01,01,01,00,00,01,00,00,00,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01}
					  },


{
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{04,04,01,01,01,01,01,01,04,04,04,04,04,04,01,01,01,01,01,01,00,00,00,00,00,00,00,00,00,00,00,00,00,00,01,01,01,01,01,01},
{04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,00,14,14,13,13,13,13,13,13,13,13,13,13,14,14,00,01,01,01,01,01},
{06,06,04,04,04,04,04,04,06,06,06,06,06,06,04,04,04,04,04,00,14,13,13,13,13,13,13,13,05,13,13,13,13,14,00,01,01,01,01,01},
{06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,00,13,13,05,13,13,13,13,13,00,13,13,13,13,13,00,01,00,01,01,01},
{06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,00,13,13,13,13,13,13,13,00,07,00,13,13,13,13,00,00,07,00,01,01},
{14,14,06,06,06,06,06,06,14,14,14,14,14,14,06,06,06,06,06,00,13,13,13,13,13,05,13,00,07,07,00,13,13,13,00,07,07,00,01,01},
{14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,00,13,13,13,13,13,13,13,00,07,07,07,07,07,07,07,07,07,00,01,01},
{10,10,14,14,14,14,14,14,10,10,10,10,10,10,14,14,00,00,00,00,13,13,13,13,13,13,00,07,07,07,07,07,07,07,07,07,07,07,00,01},
{10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,00,07,07,07,00,13,05,13,13,13,13,00,07,07,07,00,07,07,07,07,00,07,07,00,01},
{ 9, 9,10,10,10,10,10,10, 9, 9, 9, 9, 9, 9,10,10,00,00,00,00,13,13,13,13,05,13,00,07,12,12,07,07,07,07,07,07,12,12,00,01},
{ 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9,00,14,13,05,13,13,13,00,07,12,12,00,07,07,07,07,00,12,12,00,01},
{05,05, 9, 9, 9, 9, 9, 9,05,05,05,05,05,05, 9, 9, 9, 9,00,00,14,14,13,13,13,13,13,00,07,07,00,00,00,00,00,00,07,00,01,01},
{05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,00,07,07,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,01,01,01},
{05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,00,07,07,00,01,00,07,00,01,01,01,01,00,07,00,01,01,07,00,01,01,01},
{01,01,05,05,05,05,05,05,01,01,01,01,01,01,05,05,05,05,05,00,00,00,01,01,00,00,01,01,01,01,01,00,00,01,01,00,00,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01}
					  },


{
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{04,04,01,01,01,01,01,01,04,04,04,04,04,04,01,01,01,01,01,01,00,00,00,00,00,00,00,00,00,00,00,00,00,00,01,01,01,01,01,01},
{04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,00,14,14,13,13,13,13,13,13,13,13,13,13,14,14,00,01,01,01,01,01},
{06,06,04,04,04,04,04,04,06,06,06,06,06,06,04,04,04,04,04,00,14,13,13,13,13,13,13,13,05,13,13,13,13,14,00,01,01,01,01,01},
{06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,00,13,13,05,13,13,13,13,13,00,13,13,13,13,13,00,01,00,01,01,01},
{06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,00,13,13,13,13,13,13,13,00,07,00,13,13,13,13,00,00,07,00,01,01},
{14,14,06,06,06,06,06,06,14,14,14,14,14,14,06,06,06,06,06,00,13,13,13,13,13,05,13,00,07,07,00,13,13,13,00,07,07,00,01,01},
{14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,00,13,13,13,13,13,13,13,00,07,07,07,07,07,07,07,07,07,00,01,01},
{10,10,14,14,14,14,14,14,10,10,10,10,10,10,14,14,14,00,00,00,13,13,13,13,13,13,00,07,07,07,07,07,07,07,07,07,07,07,00,01},
{10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,00,07,07,00,13,05,13,13,13,13,00,07,07,07,00,07,07,07,07,00,07,07,00,01},
{ 9, 9,10,10,10,10,10,10, 9, 9, 9, 9, 9, 9,10,10,00,07,00,00,13,13,13,13,05,13,00,07,12,12,07,07,07,07,07,07,12,12,00,01},
{ 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9,00, 9,00,14,13,05,13,13,13,00,07,12,12,00,07,07,07,07,00,12,12,00,01},
{05,05, 9, 9, 9, 9, 9, 9,05,05,05,05,05,05, 9, 9, 9, 9, 9,00,14,14,13,13,13,13,13,00,07,07,00,00,00,00,00,00,07,00,01,01},
{05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,00,07,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,01,01,01},
{05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,00,07,07,00,01,00,07,00,01,01,01,01,00,07,00,01,01,07,00,01,01},
{01,01,05,05,05,05,05,05,01,01,01,01,01,01,05,05,05,05,05,05,00,00,00,01,01,00,00,01,01,01,01,01,00,00,01,01,00,00,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01}
					  },


{
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,04,04,04,04,04,04,01,01,01,01,01,01,04,04,04,04,04,04,00,00,00,00,00,00,00,00,00,00,00,00,00,00,01,01,01,01,01,01},
{04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,00,14,14,13,13,13,13,13,13,13,13,13,13,14,14,00,01,01,01,01,01},
{04,04,06,06,06,06,06,06,04,04,04,04,04,04,06,06,06,06,06,00,14,13,13,13,13,13,13,13,05,13,13,13,13,14,00,01,01,01,01,01},
{06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,00,13,13,05,13,13,13,13,13,00,13,13,13,13,13,00,01,00,01,01,01},
{06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,00,13,13,13,13,13,13,13,00,07,00,13,13,13,13,00,00,07,00,01,01},
{06,06,14,14,14,14,14,14,06,06,06,06,06,06,14,14,14,14,14,00,13,13,13,13,13,05,13,00,07,07,00,13,13,13,00,07,07,00,01,01},
{14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,00,13,13,13,13,13,13,13,00,07,07,07,07,07,07,07,07,07,00,01,01},
{14,14,10,10,10,10,10,10,14,14,14,14,14,14,10,10,10,10,10,00,13,13,13,13,13,13,00,07,07,07,07,07,07,07,07,07,07,07,00,01},
{10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,00,00,13,05,13,13,13,13,00,07,07,07,00,07,07,07,07,00,07,07,00,01},
{10,10, 9, 9, 9, 9, 9, 9,10,10,10,10,10,10, 9, 9,00,00,07,00,13,13,13,13,05,13,00,07,12,12,07,07,07,07,07,07,12,12,00,01},
{ 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9,00,07,07,00,00,14,13,05,13,13,13,00,07,12,12,00,07,07,07,07,00,12,12,00,01},
{ 9, 9,05,05,05,05,05,05, 9, 9, 9, 9, 9, 9,05,05,00,00,05,00,14,14,13,13,13,13,13,00,07,07,00,00,00,00,00,00,07,00,01,01},
{05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,00,07,07,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,01,01,01},
{05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,00,07,07,00,01,00,07,00,01,01,01,01,00,07,00,01,00,07,00,01,01,01},
{05,05,01,01,01,01,01,01,05,05,05,05,05,05,01,01,01,01,01,00,00,01,01,01,00,01,01,01,01,01,01,00,01,01,01,00,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01}
					  },


{
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},


{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,04,04,04,04,04,04,01,01,01,01,01,01,04,04,04,04,04,04,00,00,00,00,00,00,00,00,00,00,00,00,00,00,01,01,01,01,01,01},
{04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,00,14,14,13,13,13,13,13,13,13,13,13,13,14,14,00,01,01,01,01,01},
{04,04,06,06,06,06,06,06,04,04,04,04,04,04,06,06,06,06,06,00,14,13,13,13,13,13,13,13,05,13,13,13,13,14,00,01,01,01,01,01},
{06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,00,13,13,05,13,13,13,13,13,00,13,13,13,13,13,00,01,00,01,01,01},
{06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,00,13,13,13,13,13,13,13,00,07,00,13,13,13,13,00,00,07,00,01,01},
{06,06,14,14,14,14,14,14,06,06,06,06,06,06,14,14,14,14,14,00,13,13,13,13,13,05,13,00,07,07,00,13,13,13,00,07,07,00,01,01},
{14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,00,13,13,13,13,13,13,13,00,07,07,07,07,07,07,07,07,07,00,01,01},
{14,14,10,10,10,10,10,10,14,14,14,14,14,14,10,10,10,10,10,00,13,13,13,13,13,13,00,07,07,07,07,07,07,07,07,07,07,07,00,01},
{10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,00,00,00,00,13,05,13,13,13,13,00,07,07,07,00,07,07,07,07,00,07,07,00,01},
{10,10, 9, 9, 9, 9, 9, 9,10,10,10,10,10,10, 9,00,07,07,07,00,13,13,13,13,05,13,00,07,12,12,07,07,07,07,07,07,12,12,00,01},
{ 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9,00,00,00,00,14,13,05,13,13,13,00,07,12,12,00,07,07,07,07,00,12,12,00,01},
{ 9, 9,05,05,05,05,05,05, 9, 9, 9, 9, 9, 9,05,05,05,05,00,00,14,14,13,13,13,13,13,00,07,07,00,00,00,00,00,00,07,00,01,01},
{05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,00,07,07,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,01,01,01},
{05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,00,07,07,00,01,00,07,00,01,01,01,01,00,07,00,01,00,07,00,01,01,01,01},
{05,05,01,01,01,01,01,01,05,05,05,05,05,05,01,01,01,01,00,00,01,01,01,00,01,01,01,01,01,01,00,01,01,01,00,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01}
					  },


{
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{04,04,01,01,01,01,01,01,04,04,04,04,04,04,01,01,01,01,01,01,00,00,00,00,00,00,00,00,00,00,00,00,00,00,01,01,01,01,01,01},
{04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,00,14,14,13,13,13,13,13,13,13,13,13,13,14,14,00,01,01,01,01,01},
{06,06,04,04,04,04,04,04,06,06,06,06,06,06,04,04,04,04,04,00,14,13,13,13,13,13,13,13,05,13,13,13,13,14,00,01,01,01,01,01},
{06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,00,13,13,05,13,13,13,13,13,00,13,13,13,13,13,00,01,00,01,01,01},
{06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,00,13,13,13,13,13,13,13,00,07,00,13,13,13,13,00,00,07,00,01,01},
{14,14,06,06,06,06,06,06,14,14,14,14,14,14,06,06,06,06,06,00,13,13,13,13,13,05,13,00,07,07,00,13,13,13,00,07,07,00,01,01},
{14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,00,00,14,00,13,13,13,13,13,13,13,00,07,07,07,07,07,07,07,07,07,00,01,01},
{10,10,14,14,14,14,14,14,10,10,10,10,10,10,14,00,07,07,00,00,13,13,13,13,13,13,00,07,07,07,07,07,07,07,07,07,07,07,00,01},
{10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,00,00,07,00,13,05,13,13,13,13,00,07,07,07,00,07,07,07,07,00,07,07,00,01},
{ 9, 9,10,10,10,10,10,10, 9, 9, 9, 9, 9, 9,10,10,10,10,00,00,13,13,13,13,05,13,00,07,12,12,07,07,07,07,07,07,12,12,00,01},
{ 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9,00,14,13,05,13,13,13,00,07,12,12,00,07,07,07,07,00,12,12,00,01},
{05,05, 9, 9, 9, 9, 9, 9,05,05,05,05,05,05, 9, 9, 9, 9,00,00,14,14,13,13,13,13,13,00,07,07,00,00,00,00,00,00,07,00,01,01},
{05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,00,07,07,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,01,01,01},
{05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,00,07,07,00,01,00,07,00,01,01,01,01,00,07,00,01,00,07,00,01,01,01,01,01},
{01,01,05,05,05,05,05,05,01,01,01,01,01,01,05,05,05,00,00,05,01,01,00,01,01,01,01,01,01,00,01,01,01,00,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01}
					  },


{
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{04,04,01,01,01,01,01,01,04,04,04,04,04,04,01,01,01,01,01,01,00,00,00,00,00,00,00,00,00,00,00,00,00,00,01,01,01,01,01,01},
{04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,00,14,14,13,13,13,13,13,13,13,13,13,13,14,14,00,01,01,01,01,01},
{06,06,04,04,04,04,04,04,06,06,06,06,06,06,04,04,04,04,04,00,14,13,13,13,13,13,13,13,05,13,13,13,13,14,00,01,01,01,01,01},
{06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,00,13,13,05,13,13,13,13,13,00,13,13,13,13,13,00,01,00,01,01,01},
{06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,00,13,13,13,13,13,13,13,00,07,00,13,13,13,13,00,00,07,00,01,01},
{14,14,06,06,06,06,06,06,14,14,14,14,14,14,06,06,00,06,06,00,13,13,13,13,13,05,13,00,07,07,00,13,13,13,00,07,07,00,01,01},
{14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,00,07,00,14,00,13,13,13,13,13,13,13,00,07,07,07,07,07,07,07,07,07,00,01,01},
{10,10,14,14,14,14,14,14,10,10,10,10,10,10,14,14,00,07,00,00,13,13,13,13,13,13,00,07,07,07,07,07,07,07,07,07,07,07,00,01},
{10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,00,07,00,13,05,13,13,13,13,00,07,07,07,00,07,07,07,07,00,07,07,00,01},
{ 9, 9,10,10,10,10,10,10, 9, 9, 9, 9, 9, 9,10,10,10,10,00,00,13,13,13,13,05,13,00,07,12,12,07,07,07,07,07,07,12,12,00,01},
{ 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9,00,14,13,05,13,13,13,00,07,12,12,00,07,07,07,07,00,12,12,00,01},
{05,05, 9, 9, 9, 9, 9, 9,05,05,05,05,05,05, 9, 9, 9, 9, 9,00,14,14,13,13,13,13,13,00,07,07,00,00,00,00,00,00,07,00,01,01},
{05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,01,01,01},
{05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,00,07,07,00,00,07,00,01,01,01,01,00,07,00,01,00,07,00,01,01,01,01,01,01},
{01,01,05,05,05,05,05,05,01,01,01,01,01,01,05,05,00,07,07,00,01,00,01,01,01,01,01,01,00,01,01,01,00,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,00,00,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01}
					  },};


char base_01_45 [25][40] = {
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,04,04,04,04,04,04,01,01,01,01,01,01,04,04,04,04,04,04,00,00,00,00,00,00,00,00,00,00,00,00,00,00,01,01,01,01,01,01},
{04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,00,14,14,13,13,13,13,13,13,13,13,13,13,14,14,00,01,01,01,01,01},
{04,04,06,06,06,06,06,06,04,04,04,04,04,04,06,06,06,06,06,00,14,13,13,13,13,13,13,13,05,13,13,13,13,14,00,01,01,01,01,01},
{06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,00,13,13,05,13,13,13,13,13,00,13,13,13,13,13,00,01,00,01,01,01},
{06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,00,13,13,13,13,13,13,13,00,07,00,13,13,13,13,00,00,07,00,01,01},
{06,06,14,14,14,14,14,14,06,06,06,06,06,06,14,14,14,14,14,00,13,13,13,13,13,05,13,00,07,07,00,13,13,13,00,07,07,00,01,01},
{14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,00,13,13,13,13,13,13,13,00,07,07,07,07,07,07,07,07,07,00,01,01},
{14,14,10,10,10,10,10,10,14,14,14,14,14,14,10,10,10,10,10,00,13,13,13,13,13,13,00,07,07,07,07,07,07,07,07,07,07,07,00,01},
{10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,00,13,05,13,13,13,13,00,07,07,07,00,07,07,07,07,00,07,07,00,01},
{10,10, 9, 9, 9, 9, 9, 9,10,10,10,10,10,10, 9, 9, 9, 9, 9,00,13,13,13,13,05,13,00,07,12,12,07,07,07,07,07,07,12,12,00,01},
{ 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9,00,14,13,05,13,13,13,00,07,12,12,00,07,07,07,07,00,12,12,00,01},
{ 9, 9,05,05,05,05,05,05, 9, 9, 9, 9, 9, 9,05,05,05,05,05,00,14,14,13,13,13,13,13,00,07,07,00,00,00,00,00,00,07,00,01,01},
{05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,01,01,01},
{05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,00,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{05,05,01,01,01,01,01,01,05,05,05,05,05,05,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01}
					  };


char base_23_67 [25][40] = {
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{04,04,01,01,01,01,01,01,04,04,04,04,04,04,01,01,01,01,01,01,00,00,00,00,00,00,00,00,00,00,00,00,00,00,01,01,01,01,01,01},
{04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,00,14,14,13,13,13,13,13,13,13,13,13,13,14,14,00,01,01,01,01,01},
{06,06,04,04,04,04,04,04,06,06,06,06,06,06,04,04,04,04,04,00,14,13,13,13,13,13,13,13,05,13,13,13,13,14,00,01,01,01,01,01},
{06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,00,13,13,05,13,13,13,13,13,00,13,13,13,13,13,00,01,00,01,01,01},
{06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,06,00,13,13,13,13,13,13,13,00,07,00,13,13,13,13,00,00,07,00,01,01},
{14,14,06,06,06,06,06,06,14,14,14,14,14,14,06,06,06,06,06,00,13,13,13,13,13,05,13,00,07,07,00,13,13,13,00,07,07,00,01,01},
{14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,00,13,13,13,13,13,13,13,00,07,07,07,07,07,07,07,07,07,00,01,01},
{10,10,14,14,14,14,14,14,10,10,10,10,10,10,14,14,14,14,14,00,13,13,13,13,13,13,00,07,07,07,07,07,07,07,07,07,07,07,00,01},
{10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,00,13,05,13,13,13,13,00,07,07,07,00,07,07,07,07,00,07,07,00,01},
{ 9, 9,10,10,10,10,10,10, 9, 9, 9, 9, 9, 9,10,10,10,10,10,00,13,13,13,13,05,13,00,07,12,12,07,07,07,07,07,07,12,12,00,01},
{ 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9,00,14,13,05,13,13,13,00,07,12,12,00,07,07,07,07,00,12,12,00,01},
{05,05, 9, 9, 9, 9, 9, 9,05,05,05,05,05,05, 9, 9, 9, 9, 9,00,14,14,13,13,13,13,13,00,07,07,00,00,00,00,00,00,07,00,01,01},
{05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,01,01,01},
{05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,05,00,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,05,05,05,05,05,05,01,01,01,01,01,01,05,05,05,05,05,05,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01},
{01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01}
					  };

void interrupt new_int8(void){  // The new int8. As we only need it to
  asm{                                                  // measure time, this does nothing, we
	mov al,0x20                                     // send the End Of Interrupt
	out 0x20,al
  }
}


void captura_int8(void){        // We have to 'capture' the int8, as we need it
							// to know when just to play the next sample
  old_int8=getvect(0x08);
  setvect(0x08,new_int8);
}


void libera_int8(void){         // This liberates the int8
  setvect(0x08,old_int8);
}

void libera_int9(void){         // This liberates the int9
  setvect(0x09,old_int9);
}

void inicia_sonido(void){
  outportb(0x43,0x90);          // Program timer2, mode0, generate pulse when
							// countdown ends
  outportb(0x61,(inportb(0x61)|0x03));  // Connect timer2 to the speaker
  outportb(0x43,0x36);                          // Program timer0 mode3, square wave with
									// frecuency dependant of the countdown
  asm{                                                          // We start the countdown
	push ax
	mov ax,cuenta_atras
	out 0x40,al
	mov al,ah
	out 0x40,al
	pop ax
  }

}

void termina_sonido(void){
  outportb(0x43,0x36);                  // Reprogram the timers as the standard values
  outportb(0x40,0);
  outportb(0x40,0);
  outportb(0x43,0xB6);
  outportb(0x61,inportb(0x61)&0xFC);
}

void modo_40x25(void){          // Set the 40x25 text mode
  asm{
	push ax
	push cx
	mov ah,00h
	mov al,00h
	int 010h

	mov ah,001h
	mov al,00h
	mov cx,2607h  // Disable cursor
	int 010h
	pop cx
	pop ax
  }
}

void modo_80x25(void){
	asm{
		mov ah,00h
		mov al,02h
		int 010h
	}
}

void cambia_pagina(char pagina){        // Changes the CGA active text page
  asm{
	mov ah,05h
	mov al,pagina
	int 10h
  }
}

void mira_offset_pagina(void){  // Looks for the offsets of the text pages
  int contador;

  for (contador=0;contador<8;contador++){
	cambia_pagina(contador); // Change active page
	offset_pagina[contador]=peek(0x0040,0x004e); // Read page start offset
	offset_pagina_div[contador]=peek(0x0040,0x004e)/2;
				// Read page start offset and divide it by two,
				// needed for the 6845 programming
  }


}


void print (char pagina, char x, char y, char color, char caracter){
	x=x*2;
	pokeb(0xb800,(y*80)+x+offset_pagina[pagina],caracter); // Shitty videomem character plot
	pokeb(0xb800,(y*80)+x+1+offset_pagina[pagina],color);
}

void carga_frames(void){
	int z,x,y,segmento,desplazamiento;
	for (z=7;z>=1;z--){
	  cambia_pagina(0);
	  for (x=0;x<40;x++)
		for (y=0;y<25;y++)
		  print(z,x,y,matriz[z][y][x],219);
	}

	segmento=FP_SEG(frame0);
	desplazamiento=FP_OFF(frame0);

	for (x=0;x<40;x++)
	  for (y=0;y<25;y++){
		z=x*2;
		pokeb(segmento,(y*80)+z+desplazamiento,219);
		pokeb(segmento,(y*80)+z+1+desplazamiento,matriz[0][y][x]);
	  }

}

void pon_frame0(void){  // This copies the first frame on page 0 on asm,
						// just for drawing it quickly
  int segmento,desplazamiento;
	segmento=FP_SEG(frame0);
	desplazamiento=FP_OFF(frame0);

	asm{
	  push ds
	  push si

	  mov ax,0xb800
	  mov es,ax
	  mov di,0
	  mov ax,segmento
	  mov ds,ax
	  mov si,desplazamiento
	  mov cx,1000
	  rep movsw
	  pop si
	  pop ds
	}
}

void play_intro(int segm,int desp,int longitud){
				// This plays the first part of the song, where the
				// screen is black. As you can see, the playback loop is
				// much less optimized, as we have to do nothing while the
				// music is playing.
		asm{
		  push si
		  push ds

		  mov ax,segm
		  mov ds,ax
		  mov si,desp
		  mov cx,longitud
		}
loop_audio:

		asm{
		  hlt
		  lodsb
		  shr al,1              // Dividing the samples on real time!
		  out 0x42,al
		  loop loop_audio
		  pop ds
		  pop si
		}

}


void play_audio(int segm,int desp,int longitud){
	   // This function is the core of the animation.
	   // It plays the music and changes the CGA active page
	   // As it is called from an infinite loop on the main function
	   // we need to monitor if the user has pressed the ESC key to exit
	   // the animation.
	   // We avoid the use of the slow INT polling method
	   // instead we captured the INT 9 to monitor the
	   // keypresses
	int segarofs=FP_SEG(offset_pagina_div); // Offset of word where we have
											// stored the offsets of the
											// CGA pages

		asm{
		  push ds
		  push si
		  push es

		  mov bx,0      // Sample counter, every 800 samples we have to
					// play one frame, as we want one every 100ms
					// 8000hz = 8000 samples / second
		  mov ax,segarofs
		  mov es,ax         // ES will point to the array with the offset
							// of the CGA pages
		  mov dh,pagina     // frame variable, has the CGA active page
		  mov cx,longitud   // lenght of the buffer
		  mov ax,segm       // segment & offset of the buffer
		  mov si,desp
		  mov ds,ax

		  mov al,dh             // Before starting the main loop we set
		  mov ah,05h            // the active page
		  int 10h                               // As this is out the main loop we can use
		  inc dh                                // the slow way of doing it: INT 10h
		  cmp dh,8
		  jz vuelta
		}
loop_audio:                     // Music main loop
								// here is the 'magra', the big thing
		asm{
		  lodsb                 // load the next sample from the buffer
		  out 0x42,al                   // play it...

		  inc bx                // We count how many samples have played
		  cmp bx,800            // and when we get 800 we have to
		  jz cambia_pagina      // change the active page

		  hlt                   // wait the required time
		  loop loop_audio       // and repeat!
		  jmp sal
		}
cambia_pagina:
		asm{
								// This routine changes the CGA active page
								// every 100ms
		  mov al,dh             // get the next frame to display (dh)
		  //mov ah,05h          // The normal approach would be to use
		  //int 10h             // INT 10h's 05h function to change page...
						// ... but this is done getting the new page start
						// offset by MULtiplying the value in AL with
						// the size of one page: 2048*AL=CX. After that
						// INT 10h divided the result by SARing it.
						// Instead of that, we have an array with the SARed
						// page offsets and we just get them, avoiding the
						// super slow MUL instruction :)
		  mov bx,dx                             // Save DX on BX
		  push cx                               // Save CX (main loop counter) on stack

		  sal al,1              // Multiply the active page by two, as
								// the array where we have the offset is
								// word long
		  cbw                                   // AX=AL
		  mov di,ax                             // offset of the array element on the array

		  mov cx,es:[di]                // Gets the offset of the required CGA page
								// already shifted on CX!

		  mov ah,12
		  mov dx,0x03d4                 // Address register of CGA's 6845
		  mov al,ah
		  out dx,al                             // Register set

		  inc dx                                // Data register
		  mov al,ch                             // Load MSB of data...
		  out dx,al
		  dec dx
		  mov al,ah
		  inc al                // point to other data register...
		  out dx,al             // set for second register
		  inc dx

		  mov al,cl             // Load LSB of data
		  out dx,al             // and that's it!

		  pop cx                // Page changed, we need CX back...

		  mov dx,bx                             // Restore DX...

		  xor bx,bx                             // We set bx=0 to start counting again

		  inc dh                // increment the frame counter
		  cmp dh,8              // and if gets out of boundaries (0-7)
		  jz vuelta             // we set it 0

		  hlt
		  loop loop_audio
		  jmp sal
		}
vuelta:
		asm{
		  xor dh,dh             // Start again from the frame 0

		  hlt
		  loop loop_audio
		  jmp sal
		}
sal:
		asm{
		  pop es
		  pop si                // Restore data segment register
		  pop ds
		  mov pagina,dh         // and frame & execution variables
		}
}

void pantalla_negra(void){      // This function draws a black screen
  asm{
	push es
	push di
	mov ax,0xb800
	mov es,ax
	mov di,0
	mov cx,1000
	mov ax,0
	rep stosw
	pop di
	pop es
  }
}

void creditos(void){
		// End credits
	printf("           ##    #\n");
	printf("         #;i:;# # #\n");
	printf("         ;;ii;;  #\n");
	printf("    #    ;;ii;;  #\n");
	printf("   # ##G##i##i##G#\n");
	printf("    # #G##i##i##G#\n");
	printf("       #i;iiii;i#     # # # ###  # #  #   ### ### ###\n");
	printf("       #;iiiiii;#     # # # #    # #  #   # # #    #\n");
	printf("       #;iiiiii;#     # # # ##   # #  #   # # ##   #\n");
	printf("      #i;######;i#     #  # ### ## #### # # # ###  #\n");
	printf("      #i##E##E##i#\n");
	printf("      #E##E##E##E#\n");
	printf("     #j##########j#\n");
	printf("     jGGG######GGGj          ษอออออออออออออออออออออออออออป\n");
	printf("   ###GGjjGGGGjjGG###        บ  NYAN CAT for the IBM PC  บ\n");
	printf("  #G#G#GGG####GGG#GGj#       บ                           บ\n");
	printf("  G#GGG#G#EEEE#G#GGG#G       บ        CC 2013 JoJo       บ\n");
	printf("  G#GGG#G#E##E#G#G#G#G       บ       jojo@vieju.net      บ\n");
	printf(" ###Gj#GG#EEEE#G#G#####      บ    http://www.vieju.net   บ\n");
	printf("#  ###GGG######GG###   #     ศอออออออออออออออออออออออออออผ\n");
	printf("     #GGG#EEEE#GG#\n");
	printf("     #jjGGGGGGGjj#\n");
	printf("      ###########");
}

void preshift_buffers(void){
  int contador;
				// Shitty audio buffer preprocess, we divide all the samples
				// by two, as they are unsigned byte
				// to save cpu time on the main loop
  for (contador=0;contador<buffer_size;contador++){
	buffer0[contador]=buffer0[contador]/2;
	buffer1[contador]=buffer1[contador]/2;
	buffer2[contador]=buffer2[contador]/2;
  }

  for (contador=0;contador<final_size;contador++){
	final[contador]=final[contador]/2;

  }

}

void interrupt new_int9(){
	// This is the code executed when there is a hard INT1, when
	// somebody presses a key
  asm{
	in al,0x60                      // So we get the key pressed...
	cmp al,1                        // check if it's ESC scancode (1)
	jnz noesc                       // it's not? Nothing to do here
	mov al,0					// Esc pressed!
	out 0x60,al					// We clear the key pressed as we do not
  }								// want it to enter the key buffer.
  termina_sonido();             // After that, we restore the original values
  libera_int9();                // for the timer, we restore the INT 8 & INT 9
  libera_int8();                // Set the 80x25 mode, display the credits,
  modo_80x25();                 // execute the old INT 9 code and exit the program.
  creditos();
  outportb(0x20,0x20);
  old_int9();
  exit(0);

noesc:
	outportb(0x20,0x20);    // No ESC pressed? We execute the original code
	old_int9();                             // and finish the interrupt

}
void captura_int9(void){        // We have to 'capture' the int8, as we need it
							// to know when just to play the next sample
  old_int9=getvect(0x09);
  setvect(0x09,new_int9);
}

/**************************************************************************
********************************* MAIN ************************************
***************************************************************************/

void main(void){
								   // First we reserve memory for the
								   // audio blocks...
  if ((intro = (unsigned char *) farmalloc(intro_size)) == NULL){
	printf("Not enough memory!\n");
	exit(1);
  }
  if ((buffer0 = (unsigned char *) farmalloc(buffer_size)) == NULL){
	printf("Not enough memory!\n");
	exit(1);
  }
  if ((buffer1 = (unsigned char *) farmalloc(buffer_size)) == NULL){
	printf("Not enough memory!\n");
	exit(1);
  }
  if ((buffer2 = (unsigned char *) farmalloc(buffer_size)) == NULL){
	printf("Not enough memory!\n");
	exit(1);
  }
  if ((final = (unsigned char *) farmalloc(final_size)) == NULL){
	printf("Not enough memory!\n");
	exit(1);
  }                                             // also a little memory for the animation first frame
  if ((frame0 = (unsigned char *) farmalloc(2000)) == NULL){
	printf("Not enough memory!\n");
	exit(1);
  }

  printf("NyanCat for the IBM PC v1.0\n\n");
  printf("\nGood! You have %lu extra bytes free :D", farcoreleft());
  printf("\nLoading...");

  captura_int8();
  captura_int9();
  inicia_sonido();

  archivo = fopen("intro.snd", "rb");
  fread(intro,intro_size,1,archivo);
  fclose(archivo);

  archivo = fopen("nyan.snd", "rb");
  fread(buffer0,buffer_size,1,archivo);
  fread(buffer1,buffer_size,1,archivo);
  fread(buffer2,buffer_size,1,archivo);
  fread(final,final_size,1,archivo);
  fclose(archivo);

  preshift_buffers();

  modo_40x25();
  mira_offset_pagina();

  carga_frames();

  pantalla_negra();

  play_intro(FP_SEG(intro),FP_OFF(intro),intro_size);

  pon_frame0();

  while (1){    // Infinite loop, as keyboard monitoring code is on a
				// hardware INT
	play_audio(FP_SEG(buffer0),FP_OFF(buffer0),buffer_size);
	play_audio(FP_SEG(buffer1),FP_OFF(buffer1),buffer_size);
	play_audio(FP_SEG(buffer2),FP_OFF(buffer2),buffer_size);
	play_audio(FP_SEG(final),FP_OFF(final),final_size);
  }

}
